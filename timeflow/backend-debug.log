
> timeflow@0.1.0 dev:backend /Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow
> pnpm -C apps/backend dev


> @timeflow/backend@0.1.0 dev /Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend
> tsx watch src/index.ts

üöÄ TimeFlow backend starting...
üìã Environment check:
  NODE_ENV: development
  PORT: 3001
  DATABASE_URL: ‚úì Set
  SESSION_SECRET: ‚úì Set
  ENCRYPTION_KEY: ‚úì Set
‚úÖ Imports loaded successfully
üîß Building Fastify server...
üåê Listening on port 3001...
{"level":30,"time":1767298213977,"pid":40048,"hostname":"Grants-MacBook-Air.local","msg":"Server listening at http://127.0.0.1:3001"}
‚úÖ Server ready at http://127.0.0.1:3001
{"level":30,"time":1767298213978,"pid":40048,"hostname":"Grants-MacBook-Air.local","msg":"Server listening at http://10.0.0.132:3001"}
{"level":30,"time":1767298213978,"pid":40048,"hostname":"Grants-MacBook-Air.local","msg":"TimeFlow backend listening at http://127.0.0.1:3001"}
{"level":30,"time":1767298329577,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-1","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'conversation',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 1407,
  temperature: 0.7,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 556 chars
[AssistantService][Debug] No structured JSON payload found in response.
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298334972,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-1","res":{"statusCode":200},"responseTime":5394.721958994865,"msg":"request completed"}
{"level":30,"time":1767298334978,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-2","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2203,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1877 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298351168,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-2","res":{"statusCode":200},"responseTime":16189.497500002384,"msg":"request completed"}
{"level":30,"time":1767298351170,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-3","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
{"level":30,"time":1767298351965,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-3","res":{"statusCode":200},"responseTime":794.3933329880238,"msg":"request completed"}
{"level":30,"time":1767298351967,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-4","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2240,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 2634 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298375154,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-4","res":{"statusCode":200},"responseTime":23186.854458987713,"msg":"request completed"}
{"level":30,"time":1767298375156,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-5","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2191,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1813 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298386832,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-5","res":{"statusCode":200},"responseTime":11675.933833003044,"msg":"request completed"}
{"level":30,"time":1767298386833,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-6","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2200,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 2267 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298405069,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-6","res":{"statusCode":200},"responseTime":18235.635457992554,"msg":"request completed"}
{"level":30,"time":1767298405070,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-7","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2223,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1502 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298416193,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-7","res":{"statusCode":200},"responseTime":11123.834625005722,"msg":"request completed"}
{"level":30,"time":1767298416195,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-8","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'conversation',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 1404,
  temperature: 0.7,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 344 chars
[AssistantService][Debug] No structured JSON payload found in response.
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298418366,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-8","res":{"statusCode":200},"responseTime":2171.2512080073357,"msg":"request completed"}
{"level":30,"time":1767298418369,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-9","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2210,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 2308 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298434742,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-9","res":{"statusCode":200},"responseTime":16372.592417001724,"msg":"request completed"}
{"level":30,"time":1767298434744,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-a","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2211,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 2037 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298449641,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-a","res":{"statusCode":200},"responseTime":14896.824000000954,"msg":"request completed"}
{"level":30,"time":1767298449643,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-b","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT 1
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2220,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 2077 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298467286,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-b","res":{"statusCode":200},"responseTime":17643.12316700816,"msg":"request completed"}
{"level":30,"time":1767298467286,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-c","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2213,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1581 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298478414,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-c","res":{"statusCode":200},"responseTime":11127.886250019073,"msg":"request completed"}
{"level":30,"time":1767298478415,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-d","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2210,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1659 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298491703,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-d","res":{"statusCode":200},"responseTime":13287.756540983915,"msg":"request completed"}
{"level":30,"time":1767298491704,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-e","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
{"level":30,"time":1767298492456,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-e","res":{"statusCode":200},"responseTime":752.4527499973774,"msg":"request completed"}
{"level":30,"time":1767298492458,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-f","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'conversation',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 1409,
  temperature: 0.7,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 775 chars
[AssistantService][Debug] No structured JSON payload found in response.
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298499112,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-f","res":{"statusCode":200},"responseTime":6653.630625009537,"msg":"request completed"}
{"level":30,"time":1767298499113,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-g","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2205,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1683 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298517142,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-g","res":{"statusCode":200},"responseTime":18029.320333987474,"msg":"request completed"}
{"level":30,"time":1767298517143,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-h","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2214,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 2013 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298540285,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-h","res":{"statusCode":200},"responseTime":23142.669957995415,"msg":"request completed"}
{"level":30,"time":1767298540287,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-i","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2214,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1294 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298560593,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-i","res":{"statusCode":200},"responseTime":20306.965582996607,"msg":"request completed"}
{"level":30,"time":1767298560594,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-j","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2213,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1636 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298576203,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-j","res":{"statusCode":200},"responseTime":15608.675042003393,"msg":"request completed"}
{"level":30,"time":1767298576204,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-k","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'conversation',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 1407,
  temperature: 0.7,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 648 chars
[AssistantService][Debug] No structured JSON payload found in response.
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298581351,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-k","res":{"statusCode":200},"responseTime":5146.9132080078125,"msg":"request completed"}
{"level":30,"time":1767298581353,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-l","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 2, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 4,
  contextChars: 2203,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1846 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298593106,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-l","res":{"statusCode":200},"responseTime":11752.88041600585,"msg":"request completed"}
{"level":30,"time":1767298593107,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-m","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
{"level":30,"time":1767298593904,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-m","res":{"statusCode":200},"responseTime":797.1337919831276,"msg":"request completed"}
{"level":30,"time":1767298593905,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-n","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 2, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'scheduling',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 4,
  contextChars: 2203,
  temperature: 0.2,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 1886 chars
[AssistantService][Debug] Validation: PASSED (errors=0, warnings=0)
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298606388,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-n","res":{"statusCode":200},"responseTime":12482.701292008162,"msg":"request completed"}
{"level":30,"time":1767298606389,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-o","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
{"level":30,"time":1767298607085,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-o","res":{"statusCode":200},"responseTime":695.8553749918938,"msg":"request completed"}
{"level":30,"time":1767298607087,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-p","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
{"level":30,"time":1767298607694,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-p","res":{"statusCode":200},"responseTime":607.4214580059052,"msg":"request completed"}
{"level":30,"time":1767298607696,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-q","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'planning',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2152,
  temperature: 0.7,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 685 chars
[AssistantService][Debug] No structured JSON payload found in response.
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298611354,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-q","res":{"statusCode":200},"responseTime":3657.5627080202103,"msg":"request completed"}
{"level":30,"time":1767298611356,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-r","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT 1
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
[AssistantService][Debug] LLM request: {
  mode: 'planning',
  provider: 'openai',
  endpoint: 'https://api.openai.com/v1/chat/completions',
  model: 'gpt-4o-mini',
  messages: 2,
  contextChars: 2268,
  temperature: 0.7,
  maxTokens: 4000
}
[AssistantService][Debug] LLM response length: 664 chars
[AssistantService][Debug] No structured JSON payload found in response.
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1147:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298615818,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-r","res":{"statusCode":200},"responseTime":4462.164415985346,"msg":"request completed"}
{"level":30,"time":1767298615819,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-s","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
{"level":30,"time":1767298616433,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-s","res":{"statusCode":200},"responseTime":614.4437499940395,"msg":"request completed"}
{"level":30,"time":1767298616434,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-t","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
{"level":30,"time":1767298617016,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-t","res":{"statusCode":200},"responseTime":581.3793340027332,"msg":"request completed"}
{"level":30,"time":1767298617017,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-u","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."SchedulingLink"."id", "public"."SchedulingLink"."userId", "public"."SchedulingLink"."name", "public"."SchedulingLink"."slug", "public"."SchedulingLink"."isActive", "public"."SchedulingLink"."durationsMinutes", "public"."SchedulingLink"."bufferBeforeMinutes", "public"."SchedulingLink"."bufferAfterMinutes", "public"."SchedulingLink"."maxBookingHorizonDays", "public"."SchedulingLink"."dailyCap", "public"."SchedulingLink"."calendarProvider", "public"."SchedulingLink"."calendarId", "public"."SchedulingLink"."googleMeetEnabled", "public"."SchedulingLink"."createdAt", "public"."SchedulingLink"."updatedAt" FROM "public"."SchedulingLink" WHERE "public"."SchedulingLink"."userId" = $1 ORDER BY "public"."SchedulingLink"."createdAt" DESC OFFSET $2
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1036:41)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298617714,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-u","res":{"statusCode":200},"responseTime":697.635165989399,"msg":"request completed"}
{"level":30,"time":1767298617716,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-v","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61582},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."SchedulingLink"."id", "public"."SchedulingLink"."userId", "public"."SchedulingLink"."name", "public"."SchedulingLink"."slug", "public"."SchedulingLink"."isActive", "public"."SchedulingLink"."durationsMinutes", "public"."SchedulingLink"."bufferBeforeMinutes", "public"."SchedulingLink"."bufferAfterMinutes", "public"."SchedulingLink"."maxBookingHorizonDays", "public"."SchedulingLink"."dailyCap", "public"."SchedulingLink"."calendarProvider", "public"."SchedulingLink"."calendarId", "public"."SchedulingLink"."googleMeetEnabled", "public"."SchedulingLink"."createdAt", "public"."SchedulingLink"."updatedAt" FROM "public"."SchedulingLink" WHERE "public"."SchedulingLink"."userId" = $1 ORDER BY "public"."SchedulingLink"."createdAt" DESC OFFSET $2
{"level":30,"time":1767298617895,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-v","res":{"statusCode":200},"responseTime":178.3266659975052,"msg":"request completed"}
{"level":30,"time":1767298617896,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-w","req":{"method":"POST","url":"/api/assistant/chat","host":"localhost:3001","remoteAddress":"127.0.0.1","remotePort":61588},"msg":"incoming request"}
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT COUNT(*) FROM (SELECT "public"."Task"."id" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3) AS "sub"
[AssistantService][Debug] unscheduledTasksCount=3
[AssistantService][Debug] detectMode input: { hasUnscheduledTasks: true }
[AssistantService][Debug] conversationHistory: { count: 0, fallback: false }
prisma:query SELECT "public"."SchedulingLink"."id", "public"."SchedulingLink"."userId", "public"."SchedulingLink"."name", "public"."SchedulingLink"."slug", "public"."SchedulingLink"."isActive", "public"."SchedulingLink"."durationsMinutes", "public"."SchedulingLink"."bufferBeforeMinutes", "public"."SchedulingLink"."bufferAfterMinutes", "public"."SchedulingLink"."maxBookingHorizonDays", "public"."SchedulingLink"."dailyCap", "public"."SchedulingLink"."calendarProvider", "public"."SchedulingLink"."calendarId", "public"."SchedulingLink"."googleMeetEnabled", "public"."SchedulingLink"."createdAt", "public"."SchedulingLink"."updatedAt" FROM "public"."SchedulingLink" WHERE "public"."SchedulingLink"."userId" = $1 ORDER BY "public"."SchedulingLink"."createdAt" DESC OFFSET $2
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) ORDER BY "public"."Task"."dueDate" ASC, "public"."Task"."priority" ASC OFFSET $3
prisma:query SELECT "public"."Task"."id", "public"."Task"."userId", "public"."Task"."title", "public"."Task"."description", "public"."Task"."durationMinutes", "public"."Task"."priority", "public"."Task"."status", "public"."Task"."dueDate", "public"."Task"."createdAt", "public"."Task"."updatedAt", "public"."Task"."categoryId" FROM "public"."Task" WHERE ("public"."Task"."userId" = $1 AND "public"."Task"."status" = $2) OFFSET $3
prisma:query SELECT "public"."Habit"."id", "public"."Habit"."title", "public"."Habit"."frequency", "public"."Habit"."daysOfWeek", "public"."Habit"."durationMinutes", "public"."Habit"."preferredTimeOfDay" FROM "public"."Habit" WHERE ("public"."Habit"."userId" = $1 AND "public"."Habit"."isActive" = $2) ORDER BY "public"."Habit"."createdAt" ASC OFFSET $3
prisma:query SELECT "public"."User"."id", "public"."User"."email", "public"."User"."name", "public"."User"."createdAt", "public"."User"."updatedAt", "public"."User"."googleId", "public"."User"."googleRefreshToken", "public"."User"."googleAccessToken", "public"."User"."googleAccessTokenExpiry", "public"."User"."timeZone", "public"."User"."wakeTime", "public"."User"."sleepTime", "public"."User"."defaultTaskDurationMinutes", "public"."User"."defaultCalendarId", "public"."User"."dailySchedule", "public"."User"."dailyScheduleConstraints", "public"."User"."meetingStartTime", "public"."User"."meetingEndTime", "public"."User"."blockedDaysOfWeek", "public"."User"."dailyMeetingSchedule" FROM "public"."User" WHERE ("public"."User"."id" = $1 AND 1=1) LIMIT $2 OFFSET $3
Error processing message: ReferenceError: meetingState is not defined
    at Module.processMessage (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/services/assistantService.ts:1036:41)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async Object.chat (/Users/grantpinkerton/Desktop/Time Flow/TimeFlow/timeflow/apps/backend/src/controllers/assistantController.ts:48:22)
{"level":30,"time":1767298618566,"pid":40048,"hostname":"Grants-MacBook-Air.local","reqId":"req-w","res":{"statusCode":200},"responseTime":669.8868339955807,"msg":"request completed"}
